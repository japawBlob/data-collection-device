<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Home hub - data collection device</title>
        <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

/* From extension marp-team.marp-vscode */
#__marp-vscode {
  all: initial;
}

/* Override VS Code default CSS rules reverting to initial
   https://github.com/microsoft/vscode/blob/master/src/vs/workbench/contrib/webview/browser/pre/main.js#L53 */
body.marp-vscode {
  padding: 0;
}

body.marp-vscode img {
  max-width: unset;
  max-height: unset;
}

body.marp-vscode a,
body.marp-vscode a:hover,
body.marp-vscode code {
  color: unset;
}

body.marp-vscode blockquote {
  background: unset;
  border-color: unset;
}

@media screen {
  body.marp-vscode {
    overflow-y: scroll;
  }

  #__marp-vscode [data-marp-vscode-slide-wrapper] {
    margin: 20px;
  }

  #__marp-vscode svg[data-marpit-svg] {
    box-shadow: 0 5px 10px rgb(0 0 0 / 25%);
    display: block;
    margin: 0;
  }

  /* Based on https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
  #code-csp-warning {
    background-color: #444;
    box-shadow: 1px 1px 1px rgb(0 0 0 / 25%);
    color: white;
    cursor: pointer;
    font-family: sans-serif;
    font-size: 12px;
    line-height: 22px;
    margin: 16px;
    padding: 6px;
    position: fixed;
    right: 0;
    text-align: center;
    top: 0;
    word-wrap: break-word;
  }

  #code-csp-warning:hover {
    text-decoration: none;
    background-color: #007acc;
    box-shadow: 2px 2px 2px rgb(0 0 0 / 25%);
  }
}

@media print {
  body.marp-vscode #code-csp-warning {
    display: none;
  }
}

</style>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
        
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="home-hub---data-collection-device">Home hub - data collection device</h1>
<p>Semestral project for CTU FEL subject B4M38AVS</p>
<p>Author: Jakub Jíra</p>
<p>Repository: <a href="https://github.com/japawBlob/data-collection-device">japawBlob/data-collection-device</a></p>
<h1 id="basic-device-information">Basic device information</h1>
<p>The main goal of the project is to create a device, that could serve as Inteligent house hub. Allowing connection of other devices, data logging and communicating with user via LCD and UART.</p>
<p>Current data being motitored are air humidity, air temperature and vibrations. This data is stored on internal EEPROM, as well as it can be sent to connected device via USART.</p>
<h1 id="used-hardware">Used hardware</h1>
<p>Microcontroller used in this project is STM32F207VC embedded in Sleepy Cat development board. This microcontroller handles all sensor data processing and communication with other devices.</p>
<p>Connection of the peripheral device is show in the following picture.</p>
<p><img src="file:///c:\Users\JakubJíra\Codes\data-collection-device\media\Wiring_diagram.png" alt="Wiring diagram"></p>
<h2 id="sensors">Sensors</h2>
<p>For measuring vibrations the built-in accellerometer AIS226DS on Sleepy Cat board is used. Accelerometer is double axis and is connected via Serial Peripheral Interface (SPI).</p>
<p>Sensor DHT11 is used for humidity and temperature mesaurements. It is connected to the Sleepy Cat board by primitive custom single-bus communication protocol.</p>
<p>Internal built-in thermometer is also initialised, but not used.</p>
<h2 id="measuring-time">Measuring time</h2>
<p>For time measurement internal Real-time clock (RTC) is used. I decided againts external RTC in order to simplify the developement and to use included hardware. External battery can be connected to the built-in RTC to preserve current time even in the case of loosing the main power source.</p>
<h2 id="hci">HCI</h2>
<p>Device uses built-in peripherals in Sleepy Cat board to provide user interface.</p>
<p>For displaying information LCD RX12864D2 with built in matrix controller ST7565 is used. It is connected via SPI.</p>
<p>Interaction with user is provided by built in buttons and rotary encoder. Exact usage described in <a href="#graphical-user-interface">Graphical user interface</a>.</p>
<h2 id="non-volatile-memory">Non-volatile memory</h2>
<p>EEPROM module M24C64 included in Sleepy Cat board is used as non-volatile data storage. Module is connected via I2C.</p>
<h1 id="software-description">Software description</h1>
<p>Rough diagram of the software function is described in the following picture.</p>
<p><img src="file:///c:\Users\JakubJíra\Codes\data-collection-device\media\main_software_loop.png" alt="Wiring diagram"></p>
<h2 id="setup">Setup</h2>
<p>Setup consists of following innitialisation routines</p>
<h3 id="uart">UART</h3>
<p>UART is configured as follow:</p>
<ul>
<li>BaudRate = 115200</li>
<li>Word Length = 8b</li>
<li>One stop bit</li>
<li>No parity</li>
</ul>
<p>Exact initialisation in following code snippet:</p>
<pre><code class="language-c++">    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">USART_InitTypeDef</span> USART_InitStructure;

    USART_InitStructure.USART_BaudRate = <span class="hljs-number">115200</span>;
    USART_InitStructure.USART_WordLength = USART_WordLength_8b;
    USART_InitStructure.USART_StopBits = USART_StopBits_1;
    USART_InitStructure.USART_Parity = USART_Parity_No;
    USART_InitStructure.USART_HardwareFlowControl = USART_HardwareFlowControl_None;
    USART_InitStructure.USART_Mode = USART_Mode_Rx | USART_Mode_Tx;

    <span class="hljs-built_in">STM_EVAL_COMInit</span>(com_port, &amp;USART_InitStructure);
</code></pre>
<h3 id="buttons">Buttons</h3>
<p>Buttons SW1 and SW2, that are built-in on Sleepy Cat board are used for user interaction.</p>
<p>They are initialised using following code snippet:</p>
<pre><code class="language-c++">    GPIO_InitTypeDef GPIO_InitStructure;
    <span class="hljs-built_in">GPIO_StructInit</span>(&amp;GPIO_InitStructure);

    <span class="hljs-built_in">RCC_AHB1PeriphClockCmd</span>(RCC_AHB1Periph_GPIOC, ENABLE);

    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_14 | GPIO_Pin_15;
    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN;
    GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
    GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;
    <span class="hljs-built_in">GPIO_Init</span>(GPIOC, &amp;GPIO_InitStructure);
</code></pre>
<h3 id="dht11">DHT11</h3>
<p>For correct DHT11 function, measuring micro seconds is requiered. For this purpose timer TIM2 is used and configured using following code snippet:</p>
<pre><code class="language-c++">    <span class="hljs-built_in">RCC_APB1PeriphClockCmd</span>(RCC_APB1Periph_TIM2, ENABLE);
    
    TIM_TimeBaseInitTypeDef timer;
    <span class="hljs-built_in">TIM_TimeBaseStructInit</span>(&amp;timer);
    
    timer.TIM_CounterMode = TIM_CounterMode_Up;
    timer.TIM_ClockDivision = TIM_CKD_DIV1;
    timer.TIM_Prescaler = <span class="hljs-number">59</span>;
    timer.TIM_Period = <span class="hljs-number">1000000</span>;
    timer.TIM_RepetitionCounter = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">TIM_TimeBaseInit</span>(DHT11_TIM, &amp;timer);
    
    <span class="hljs-built_in">TIM_ITConfig</span>(DHT11_TIM, TIM_IT_Update, ENABLE);
    <span class="hljs-built_in">TIM_Cmd</span>(DHT11_TIM, ENABLE);
</code></pre>
<p>By this configuration timer ticks every micro second, with whole period lasting one second.</p>
<p>For single wire communication B0 pin is used in both input and output mode. Following snippet is used for initialising DHT11 pin:</p>
<pre><code class="language-c++"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">set_dht11_pin</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span> mode)</span></span>{
    GPIO_InitTypeDef GPIO_InitStructure;
    <span class="hljs-built_in">GPIO_StructInit</span>(&amp;GPIO_InitStructure);
    <span class="hljs-built_in">RCC_AHB1PeriphClockCmd</span>(RCC_AHB1Periph_GPIOB, ENABLE);

    GPIO_InitStructure.GPIO_Pin = DHT11_PIN;
    GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;
    GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL;
    
    <span class="hljs-keyword">if</span> (mode == INPUT) {
        GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN;
    }
    <span class="hljs-keyword">if</span> (mode == OUTPUT) {
        GPIO_InitStructure.GPIO_Mode = GPIO_Mode_OUT;
    }
    <span class="hljs-built_in">GPIO_Init</span>(DHT11_GPIO, &amp;GPIO_InitStructure);
}
</code></pre>
<h3 id="rtc">RTC</h3>
<p>Real time clock is used for creation of timestamps, that are saved with data.</p>
<p>Following code snippet is used for configuration of RTC:</p>
<pre><code class="language-c++">    <span class="hljs-built_in">RCC_APB1PeriphClockCmd</span>(RCC_APB1Periph_PWR, ENABLE);
    <span class="hljs-built_in">PWR_BackupAccessCmd</span>(ENABLE);
    
    <span class="hljs-built_in">RCC_BackupResetCmd</span>(ENABLE);
    <span class="hljs-built_in">RCC_BackupResetCmd</span>(DISABLE);
    <span class="hljs-built_in">RTC_WriteProtectionCmd</span>(DISABLE);
    <span class="hljs-built_in">RCC_LSICmd</span>(ENABLE);
    
    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">RCC_GetFlagStatus</span>(RCC_FLAG_LSIRDY) == RESET) {}
    
    <span class="hljs-built_in">RCC_RTCCLKConfig</span>(RCC_RTCCLKSource_LSI);
    <span class="hljs-built_in">RCC_RTCCLKCmd</span>(ENABLE);
    <span class="hljs-built_in">RTC_WaitForSynchro</span>();
    
    RTC_InitTypeDef rtc_init;
    <span class="hljs-built_in">RTC_StructInit</span>(&amp;rtc_init);
    <span class="hljs-built_in">RTC_Init</span>(&amp;rtc_init);
    <span class="hljs-built_in">PWR_BackupAccessCmd</span>(DISABLE);
</code></pre>
<h3 id="eeprom">EEPROM</h3>
<p>EEPROM initialisation is provided by <em>stm32_eval_i2c_ee</em> library. Initialisation code is located in <code>sEE_Init()</code> function. This function initialises I2C bus, and sets up DMA and corresponding peripheral clocks.</p>
<h3 id="lcd">LCD</h3>
<p>LCD initialisation setups SPI communication, sets up brightness of the LCD and clears it. Function <code>LCD_Init()</code> from library <em>lcd_st7565p</em> is used for this initialisation.</p>
<h3 id="accellerometer">Accellerometer</h3>
<p>Communication with accelerometer is initialised via function <code>sACCEL_Init()</code> from <em>stm32_eval_spi_accel library</em>. After that accelerometer is initiated and reading is set up to be in big endian mode. Code is on the following snippet:</p>
<pre><code class="language-c++">    <span class="hljs-built_in">sACCEL_Init</span>();
    <span class="hljs-comment">// Enable reading</span>
    <span class="hljs-built_in">sACCEL_WriteReg</span>(<span class="hljs-number">0x20</span>, <span class="hljs-number">0x83</span>);
    <span class="hljs-comment">// Set Big endian mode</span>
    <span class="hljs-type">uint8_t</span> b = <span class="hljs-built_in">sACCEL_ReadReg</span>(<span class="hljs-number">0x21</span>);
    b |= <span class="hljs-number">0x20</span>;
    <span class="hljs-built_in">sACCEL_WriteReg</span>(<span class="hljs-number">0x21</span>, b);
</code></pre>
<p>Accelerometer in this application is used to monitor vibrations. For this functionality, periodic reading of acceleration is required to determine amount of vibrations. Timer TIM5 is used for this periodic reading of vibrations. Timer is set to generate interrupt every 50ms.</p>
<p>Following snipped is used for timer initialisation:</p>
<pre><code class="language-c++">    <span class="hljs-built_in">RCC_APB1PeriphClockCmd</span>(RCC_APB1Periph_TIM5, ENABLE);
    
    <span class="hljs-comment">//Enabeling timer interrupt</span>
    NVIC_InitTypeDef blob;
    blob.NVIC_IRQChannel = TIM5_IRQn;
    blob.NVIC_IRQChannelPreemptionPriority = <span class="hljs-number">8</span>;
    blob.NVIC_IRQChannelSubPriority = <span class="hljs-number">0</span>;
    blob.NVIC_IRQChannelCmd = ENABLE;
    <span class="hljs-built_in">NVIC_Init</span>(&amp;blob);
    
    <span class="hljs-comment">//Enabeling timer TIM_3</span>
    TIM_TimeBaseInitTypeDef timer;
    
    timer.TIM_CounterMode = TIM_CounterMode_Up;
    timer.TIM_ClockDivision = TIM_CKD_DIV1;
    timer.TIM_Prescaler = <span class="hljs-number">59</span>;
    timer.TIM_Period = <span class="hljs-number">1000</span>*<span class="hljs-number">50</span>;
    timer.TIM_RepetitionCounter = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">TIM_TimeBaseInit</span>(TIM5, &amp;timer);
    <span class="hljs-built_in">TIM_ClearITPendingBit</span>(TIM5, TIM_IT_Update);
  
    <span class="hljs-built_in">TIM_Cmd</span>(TIM5, ENABLE);
    <span class="hljs-built_in">TIM_ITConfig</span>(TIM5, TIM_IT_Update, ENABLE);
</code></pre>
<h3 id="logger">Logger</h3>
<p>Logger is a custom library written for this project. It serves the purpose of creating new data entries and managing memory.</p>
<p>Initialisation of this library consists of creating an array for storing data entries, reading EEPROM memory for any already present data, loading it, and determining the next available address.</p>
<h3 id="encoder">Encoder</h3>
<p>Encoder is used with timer TIM4 in encoder mode. The initialisation of encoder can be seen in following snippet:</p>
<pre><code class="language-c++"><span class="hljs-comment">/* Initialize the corresponding input pins */</span>
        GPIO_InitTypeDef GPIO_InitStructure;
<span class="hljs-comment">/* Enable clock to GPIOD */</span>
        <span class="hljs-built_in">RCC_AHB1PeriphClockCmd</span>(RCC_AHB1Periph_GPIOD, ENABLE);
        <span class="hljs-built_in">GPIO_StructInit</span>(&amp;GPIO_InitStructure);
        GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;
        GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;
        GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
        GPIO_InitStructure.GPIO_Pin = GPIO_Pin_12 | GPIO_Pin_13;
        GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
        <span class="hljs-built_in">GPIO_Init</span>(GPIOD, &amp;GPIO_InitStructure);
        <span class="hljs-built_in">GPIO_PinAFConfig</span>(GPIOD, GPIO_PinSource12, GPIO_AF_TIM4);
        <span class="hljs-built_in">GPIO_PinAFConfig</span>(GPIOD, GPIO_PinSource13, GPIO_AF_TIM4);

<span class="hljs-comment">/* Initialize the timer */</span>
<span class="hljs-comment">/* Enable clock to TIM4 */</span>
        <span class="hljs-built_in">RCC_APB1PeriphClockCmd</span>(RCC_APB1Periph_TIM4, ENABLE);

        TIM_TimeBaseInitTypeDef TIM_InitStructure;
        <span class="hljs-built_in">TIM_TimeBaseStructInit</span>(&amp;TIM_InitStructure);
        TIM_InitStructure.TIM_ClockDivision = TIM_CKD_DIV1;
        TIM_InitStructure.TIM_Period = <span class="hljs-number">0xFFFF</span>;
        TIM_InitStructure.TIM_Prescaler = <span class="hljs-number">0</span>;
        TIM_InitStructure.TIM_CounterMode = TIM_CounterMode_Up;
        <span class="hljs-built_in">TIM_TimeBaseInit</span>(TIM4, &amp;TIM_InitStructure);

<span class="hljs-comment">/* Set the timer up for quadrature decoding */</span>
        <span class="hljs-built_in">TIM_EncoderInterfaceConfig</span>(TIM4, TIM_EncoderMode_TI12, TIM_ICPolarity_Rising, TIM_ICPolarity_Rising);
        TIM4-&gt;CNT = ENCODER_COUNTER_ZERO;
        <span class="hljs-built_in">TIM_Cmd</span>(TIM4, ENABLE);
</code></pre>
<h2 id="main-loop">Main loop</h2>
<p>The main loop of program consists of checking Accelerometer interrupt</p>
<h3 id="read-update-and-store-data">Read, update and store data</h3>
<h3 id="handling-user-input">Handling user input</h3>
<h1 id="graphical-user-interface">Graphical user interface</h1>

        
        <script async type="text/javascript">
/* From extension marp-team.marp-vscode */
(()=>{var Y=Object.defineProperty;var d=($,E)=>Y($,"name",{value:E,configurable:!0});(()=>{var $={676:(w,b,g)=>{w.exports=g(185)},185:(w,b)=>{"use strict";var g;g={value:!0};const x={h1:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"1"},style:"display: block; font-size: 2em; margin-block-start: 0.67em; margin-block-end: 0.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h2:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"2"},style:"display: block; font-size: 1.5em; margin-block-start: 0.83em; margin-block-end: 0.83em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h3:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"3"},style:"display: block; font-size: 1.17em; margin-block-start: 1em; margin-block-end: 1em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h4:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"4"},style:"display: block; margin-block-start: 1.33em; margin-block-end: 1.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h5:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"5"},style:"display: block; font-size: 0.83em; margin-block-start: 1.67em; margin-block-end: 1.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h6:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"6"},style:"display: block; font-size: 0.67em; margin-block-start: 2.33em; margin-block-end: 2.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},span:{proto:()=>HTMLSpanElement},pre:{proto:()=>HTMLElement,style:"display: block; font-family: monospace; white-space: pre; margin: 1em 0; --marp-auto-scaling-white-space: pre;"}},k="data-marp-auto-scaling-wrapper",u="data-marp-auto-scaling-svg",c="data-marp-auto-scaling-container";class r extends HTMLElement{constructor(){super(),this.svgPreserveAspectRatio="xMinYMid meet";const o=d(i=>([n])=>{const{width:e,height:t}=n.contentRect;this[i]={width:e,height:t},this.updateSVGRect()},"t");this.attachShadow({mode:"open"}),this.containerObserver=new ResizeObserver(o("containerSize")),this.wrapperObserver=new ResizeObserver((...i)=>{o("wrapperSize")(...i),this.flushSvgDisplay()})}static get observedAttributes(){return["data-downscale-only"]}connectedCallback(){var o,i,n,e,t;this.shadowRoot.innerHTML=`
<style>
  svg[${u}] { display: block; width: 100%; height: auto; vertical-align: top; }
  span[${c}] { display: table; white-space: var(--marp-auto-scaling-white-space, nowrap); width: max-content; }
</style>
<div ${k}>
  <svg part="svg" ${u}>
    <foreignObject><span ${c}><slot></slot></span></foreignObject>
  </svg>
</div>
    `.split(/\n\s*/).join(""),this.wrapper=(o=this.shadowRoot.querySelector(`div[${k}]`))!==null&&o!==void 0?o:void 0;const s=this.svg;this.svg=(n=(i=this.wrapper)===null||i===void 0?void 0:i.querySelector(`svg[${u}]`))!==null&&n!==void 0?n:void 0,this.svg!==s&&(this.svgComputedStyle=this.svg?window.getComputedStyle(this.svg):void 0),this.container=(t=(e=this.svg)===null||e===void 0?void 0:e.querySelector(`span[${c}]`))!==null&&t!==void 0?t:void 0,this.observe()}disconnectedCallback(){this.svg=void 0,this.svgComputedStyle=void 0,this.wrapper=void 0,this.container=void 0,this.observe()}attributeChangedCallback(){this.observe()}flushSvgDisplay(){const{svg:o}=this;o&&(o.style.display="inline",requestAnimationFrame(()=>{o.style.display=""}))}observe(){this.containerObserver.disconnect(),this.wrapperObserver.disconnect(),this.wrapper&&this.wrapperObserver.observe(this.wrapper),this.container&&this.containerObserver.observe(this.container),this.svgComputedStyle&&this.observeSVGStyle(this.svgComputedStyle)}observeSVGStyle(o){const i=d(()=>{const n=(()=>{const e=o.getPropertyValue("--preserve-aspect-ratio");return e?e.trim():`x${(({textAlign:t,direction:s})=>{if(t.endsWith("left"))return"Min";if(t.endsWith("right"))return"Max";if(t==="start"||t==="end"){let a=s==="rtl";return t==="end"&&(a=!a),a?"Max":"Min"}return"Mid"})(o)}YMid meet`})();n!==this.svgPreserveAspectRatio&&(this.svgPreserveAspectRatio=n,this.updateSVGRect()),o===this.svgComputedStyle&&requestAnimationFrame(i)},"e");i()}updateSVGRect(){var o,i,n,e,t,s,a;let p=Math.ceil((i=(o=this.containerSize)===null||o===void 0?void 0:o.width)!==null&&i!==void 0?i:0);const h=Math.ceil((e=(n=this.containerSize)===null||n===void 0?void 0:n.height)!==null&&e!==void 0?e:0);this.dataset.downscaleOnly!==void 0&&(p=Math.max(p,(s=(t=this.wrapperSize)===null||t===void 0?void 0:t.width)!==null&&s!==void 0?s:0));const f=(a=this.svg)===null||a===void 0?void 0:a.querySelector(":scope > foreignObject");if(f?.setAttribute("width",`${p}`),f?.setAttribute("height",`${h}`),this.svg&&(this.svg.setAttribute("viewBox",`0 0 ${p} ${h}`),this.svg.setAttribute("preserveAspectRatio",this.svgPreserveAspectRatio),this.svg.style.height=p<=0||h<=0?"0":""),this.container){const _=this.svgPreserveAspectRatio.toLowerCase();this.container.style.marginLeft=_.startsWith("xmid")||_.startsWith("xmax")?"auto":"0",this.container.style.marginRight=_.startsWith("xmi")?"auto":"0"}}}d(r,"s");const m=d((l,{attrs:o={},style:i})=>class extends l{constructor(...n){super(...n);for(const[e,t]of Object.entries(o))this.hasAttribute(e)||this.setAttribute(e,t);this.attachShadow({mode:"open"})}static get observedAttributes(){return["data-auto-scaling"]}connectedCallback(){this._update()}attributeChangedCallback(){this._update()}_update(){const n=i?`<style>:host { ${i} }</style>`:"";let e="<slot></slot>";const{autoScaling:t}=this.dataset;t!==void 0&&(e=`<marp-auto-scaling exportparts="svg:auto-scaling" ${t==="downscale-only"?"data-downscale-only":""}>${e}</marp-auto-scaling>`),this.shadowRoot.innerHTML=n+e}},"o");let v;const V=Symbol();let C;const j="marpitSVGPolyfill:setZoomFactor,",A=Symbol(),z=Symbol(),N=d(()=>{const l=navigator.vendor==="Apple Computer, Inc.",o=l?[D]:[],i={then:n=>(l?(async()=>{if(C===void 0){const e=document.createElement("canvas");e.width=10,e.height=10;const t=e.getContext("2d"),s=new Image(10,10),a=new Promise(p=>{s.addEventListener("load",()=>p())});s.crossOrigin="anonymous",s.src="data:image/svg+xml;charset=utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2210%22%20height%3D%2210%22%20viewBox%3D%220%200%201%201%22%3E%3CforeignObject%20width%3D%221%22%20height%3D%221%22%20requiredExtensions%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22width%3A%201px%3B%20height%3A%201px%3B%20background%3A%20red%3B%20position%3A%20relative%22%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3C%2Fsvg%3E",await a,t.drawImage(s,0,0),C=t.getImageData(5,5,1,1).data[3]<128}return C})().then(e=>{n?.(e?[D]:[])}):n?.([]),i)};return Object.assign(o,i)},"h");let H,O;function D(l){const o=typeof l=="object"&&l.target||document,i=typeof l=="object"?l.zoom:l;window[z]||(Object.defineProperty(window,z,{configurable:!0,value:!0}),document.body.style.zoom=1.0001,document.body.offsetHeight,document.body.style.zoom=1,window.addEventListener("message",({data:e,origin:t})=>{if(t===window.origin)try{if(e&&typeof e=="string"&&e.startsWith(j)){const[,s]=e.split(","),a=Number.parseFloat(s);Number.isNaN(a)||(O=a)}}catch(s){console.error(s)}}));let n=!1;Array.from(o.querySelectorAll("svg[data-marpit-svg]"),e=>{var t,s,a,p;e.style.transform||(e.style.transform="translateZ(0)");const h=i||O||e.currentScale||1;H!==h&&(H=h,n=h);const f=e.getBoundingClientRect(),{length:_}=e.children;for(let T=0;T<_;T+=1){const S=e.children[T];if(S.getScreenCTM){const y=S.getScreenCTM();if(y){const G=(s=(t=S.x)===null||t===void 0?void 0:t.baseVal.value)!==null&&s!==void 0?s:0,I=(p=(a=S.y)===null||a===void 0?void 0:a.baseVal.value)!==null&&p!==void 0?p:0,Z=S.children.length;for(let F=0;F<Z;F+=1){const P=S.children[F];if(P.tagName==="SECTION"){const{style:R}=P;R.transformOrigin||(R.transformOrigin=`${-G}px ${-I}px`),R.transform=`scale(${h}) matrix(${y.a}, ${y.b}, ${y.c}, ${y.d}, ${y.e-f.left}, ${y.f-f.top}) translateZ(0.0001px)`;break}}}}}}),n!==!1&&Array.from(o.querySelectorAll("iframe"),({contentWindow:e})=>{e?.postMessage(`${j}${n}`,window.origin==="null"?"*":window.origin)})}d(D,"u");function B({once:l=!1,target:o=document}={}){const i=function(n=document){if(n[A])return n[A];let e=!0;const t=d(()=>{e=!1,delete n[A]},"i");Object.defineProperty(n,A,{configurable:!0,value:t});let s=[],a=!1;(async()=>{try{s=await N()}finally{a=!0}})();const p=d(()=>{for(const h of s)h({target:n});a&&s.length===0||e&&window.requestAnimationFrame(p)},"o");return p(),t}(o);return l?(i(),()=>{}):i}d(B,"v"),H=1,O=void 0;const W=B,M=Symbol(),L=d((l=document)=>{if(typeof window>"u")throw new Error("Marp Core's browser script is valid only in browser context.");if(((e=document)=>{const t=window[V];t||customElements.define("marp-auto-scaling",r);for(const s of Object.keys(x)){const a=`marp-${s}`,p=x[s].proto();v!=null||(v=!!document.createElement("div",{is:"marp-auto-scaling"}).outerHTML.startsWith("<div is")),v&&p!==HTMLElement?t||customElements.define(a,m(p,{style:x[s].style}),{extends:s}):(t||customElements.define(a,m(HTMLElement,x[s])),e.querySelectorAll(`${s}[is="${a}"]`).forEach(h=>{h.outerHTML=h.outerHTML.replace(new RegExp(`^<${s}`,"i"),`<${a}`).replace(new RegExp(`</${s}>$`,"i"),`</${a}>`)}))}window[V]=!0})(l),l[M])return l[M];const o=B({target:l}),i=d(()=>{o(),delete l[M]},"n"),n=Object.assign(i,{cleanup:i,update:()=>L(l)});return Object.defineProperty(l,M,{configurable:!0,value:n}),n},"y");b.browser=L,g=L,g=W}},E={};function q(w){var b=E[w];if(b!==void 0)return b.exports;var g=E[w]={exports:{}};return $[w](g,g.exports,q),g.exports}d(q,"__webpack_require__");var U={};(()=>{"use strict";var w=q(676);function b(){let u,c;const r=d(()=>{const m=document.getElementById("__marp-vscode"),v=!!m;u!==v?(document.body.classList.toggle("marp-vscode",v),v?c=(0,w.browser)():(c?.cleanup(),c=void 0),u=v):v&&c?.update(),u?(m&&g(m),x()):k()},"updateCallback");window.addEventListener("load",()=>window.setTimeout(r,100)),window.addEventListener("vscode.markdown.updateContent",r),r()}d(b,"preview");const g=d(u=>{u.querySelectorAll("[is]").forEach(c=>{if(c.nodeName.includes("-")||document.createElement(c.nodeName).constructor!==c.constructor)return;const{outerHTML:m}=c;c.outerHTML=m,console.debug("[marp-vscode] Custom element has been upgraded forcibly:",m.slice(0,m.indexOf(">")+1||void 0))})},"forceUpgradeCustomElements"),x=d(()=>{const u=document.querySelectorAll("style:not(#__marp-vscode-style,#_defaultStyles,[data-marp-vscode-body])"),c=document.querySelectorAll('link[rel="stylesheet"][href]:not([href*="marp-vscode"])');u.forEach(r=>{r.closest("#__marp-vscode")||(r.dataset.marpVscodeBody=r.textContent??"",r.textContent="")}),c.forEach(r=>{if(r.closest("#__marp-vscode"))return;const{href:m}=r;r.dataset.marpVscodeHref=m,r.removeAttribute("href")})},"removeStyles"),k=d(()=>{const u=document.querySelectorAll("style[data-marp-vscode-body]"),c=document.querySelectorAll("link[data-marp-vscode-href]");u.forEach(r=>{r.textContent=r.dataset.marpVscodeBody||"",delete r.dataset.marpVscodeBody}),c.forEach(r=>{r.href=r.dataset.marpVscodeHref||"",delete r.dataset.marpVscodeHref})},"restoreStyles");b()})()})();})();

</script>

    </body>
    </html>